#!/bin/bash
#
# Simple scratchpads with xdotool and alacritty
#
# TODO:
# - [ ] movemouse on window start
# - [ ] pull window to current screen
# - [ ] hide visibility if focused
#
CONFIG_FILE=~/.config/alacritty/scratchpad.yml
TERM_CMD_ARGS=(
  "--config-file=$CONFIG_FILE"
  "--working-directory=$HOME"
)
TERM_CMD="alacritty ${TERM_CMD_ARGS[*]}"

get_window_id () {
  local title=$1
  xdotool search --name "$title"
}

set_window_focus () {
  local title=$1
  window_id=$(get_window_id "$title")
  # Grep output: Geometry 500x300 | 500x300
  window_size=$(xdotool getwindowgeometry "$window_id" | grep 'Geometry' | grep -Eo '[0-9]+x[0-9]+')
  # cut on 'x' and divide by 2 to get center
  mouse_x=$(($(echo "$window_size" | cut -d 'x' -f1) / 2))
  mouse_y=$(($(echo "$window_size" | cut -d 'x' -f2) / 2))

  xdotool windowactivate "$window_id" mousemove --window "$window_id" "$mouse_x" "$mouse_y"
}

scratchpad_terminal () {
  local title='scratchpad'
  if ! get_window_id "$title"; then
    $TERM_CMD \
      -t "$title"
  fi
  set_window_focus "$title"
}

scratchpad_volume () {
  local title='pulsemixer'
  if ! get_window_id "$title"; then
    $TERM_CMD \
      -t "$title" \
      -e 'pulsemixer'
  fi
  set_window_focus "$title"
}

scratchpad_filemanager () {
  local title='ranger'
  if ! get_window_id "$title"; then
    $TERM_CMD \
      -t "$title" \
      -e 'ranger'
  fi
  set_window_focus "$title"
}

scratchpad_mail () {
  local title='neomutt'
  if ! get_window_id "$title"; then
    $TERM_CMD \
      -t "$title" \
      -o "window.dimensions.columns=140" \
      -o "window.dimensions.lines=40" \
      -e 'neomutt'
  fi
  set_window_focus "$title"
}

case $1 in
  terminal) scratchpad_terminal;;
  audio)    scratchpad_volume;;
  files)    scratchpad_filemanager;;
  mail)     scratchpad_mail;;
esac
